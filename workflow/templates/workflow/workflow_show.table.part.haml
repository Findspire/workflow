- load static
- load i18n
- load workflow_tags
- for category, items in categories
    %table
        %thead
            %tr.category
                %th{:style => "width: 65%;"}
                    {{ category.name }}
                    %a.controls{href: "{% url 'workflow:item_model_add_to_workcat' workflow.pk category.pk %}"}
                        {% trans "Add an item" %}

                %th.take_untake_category{:style => "width: 120px;"}
                    %span{class: "take"}
                        %a{href:"{% url 'workflow:update' which_display 'take' 'category' category.pk workflow.pk %}?next={{ request.path }}", title:"Take all items of the category"}
                            {% trans "Take all" %}
                    \/
                    %span{class: "untake"}
                        %a{href:"{% url 'workflow:update' which_display 'untake' 'category' category.pk workflow.pk %}?next={{ request.path }}", title:"Untake all items of the category"}
                            {% trans "Untake all" %}
                    %span{class: "show", id: "take_untake_category_{{ category.pk }}_show"}
                        %a{href:"{% url 'workflow:update' which_display 'show' 'category' category.pk workflow.pk %}?next={{ request.path }}"}

                %th

                %th
                
                %th
        %tbody#sortable
            - for item in items
                %tr.item_list{class: "highlight {% if forloop.counter|divisibleby:2 %}{% else %}odd_line{% endif %}", "data-url" => "{% url 'workflow:drag_item' item.pk %}", "data-item-pk" => "{{ item.pk }}"}
                    %td.item
                        %a{href: "{% url 'workflow:item_instance_show' item.pk %}", title:"{{ item.name}}"}
                            {{ item.name }}
                        - for url, ticket_id in item.name|get_tickets
                            - if forloop.counter == 1
                                %strong{style:"margin-left:20px;"}
                                    {% trans "Tickets:" %}
                            %a.urls{href:"{{ url }}", alt:"Ticket #{{ ticket_id }}"}
                                \#{{ ticket_id }}
                            - if not forloop.last
                                \-
                    
                    %td.take_untake_item
                        - if item.assigned_to_name_cache
                            {{ item.assigned_to_name_cache }}
                            %a.close{href: "{% url 'workflow:update' which_display 'untake' 'item' item.pk %}?next={{ request.path }}", title: "Reset owner of item", data-status: "mine"}
                                %img{src: "/static/workflow/img/untake.png"}
                        - else
                            %a{href: "{% url 'workflow:update' which_display 'take' 'item' item.pk %}?next={{ request.path }}", title: "Take item", data-status: "untaken"}
                                {% trans "Take" %}


                    %td{:style => "width: 72px"}
                        - if item.comments_count
                            %a.comment{:href => "#", "data-target" => "pop-up"}
                                %img{:src => "{% static 'workflow/img/comment.png' %}", :alt => ""}/
                            %div.pop-up{"data-url" => "{% url 'workflow:get_item_comments' item.pk %}"}
                                %span.close
                                    %img{:src => "{% static 'workflow/img/untake.png' %}", :alt => ""}/
                                %ul
                                
                    %td.validate
                        - if item.validation == Item.VALIDATION_SUCCESS
                            %a{href: "#", title: "Item is validated", data-url: "{% url 'workflow:update_item_validation' 'success' item.pk %}"}
                                %span.glyphicon.glyphicon-ok-sign.success.validated
                        - else
                            %a{href: "#", title: "Click to validate", data-url: "{% url 'workflow:update_item_validation' 'success' item.pk %}"}
                                %span.glyphicon.glyphicon-ok-sign.success

                        - if item.validation == Item.VALIDATION_UNTESTED
                            %a{href: "#", title: "Item is untested", data-url: "{% url 'workflow:update_item_validation' 'untested' item.pk %}"}
                                %span.glyphicon.glyphicon-question-sign.untested.validated
                        - else
                            %a{href: "#", title: "Reset item validation", data-status-old: "{{ item|get_status }}", data-status-new: "untested", data-url: "{% url 'workflow:update_item_validation' 'untested' item.pk %}"}
                                %span.glyphicon.glyphicon-question-sign.untested

                        - if item.validation == Item.VALIDATION_FAILED
                            %a{href: "#", title: "Item is broken", data-url: "{% url 'workflow:update_item_validation' 'failed' item.pk %}"}
                                %span.glyphicon.glyphicon-remove-sign.failed.validated
                        - else
                            %a{href: "#", title: "Click to failed item", data-url: "{% url 'workflow:update_item_validation' 'failed' item.pk %}"}
                                %span.glyphicon.glyphicon-remove-sign.failed

                        %br
                            %span.last_modification= item.updated_at|date:"d/m/Y H:i"


                    %td
                        %a.close{:href => "{% url 'workflow:delete_item_view' item.workflow.pk item.pk %}"}
                            %img{:src => "{% static 'workflow/img/untake.png'%}"}

